---
import BaseLayout from './BaseLayout.astro';
import WikiSidebar from '../components/wiki/WikiSidebar.astro';
import TableOfContents from '../components/wiki/TableOfContents.astro';

interface Props {
  title: string;
  description?: string;
  headings?: { depth: number; slug: string; text: string }[];
  currentSlug?: string;
  showSidebar?: boolean;
  showToc?: boolean;
}

const {
  title,
  description = '个人知识生态网站',
  headings = [],
  currentSlug = '',
  showSidebar = true,
  showToc = true,
} = Astro.props;

const hasToc = showToc && headings.length > 0;
---

<BaseLayout title={title} description={description}>
  <div
    class:list={[
      'max-w-[1400px] mx-auto min-h-[calc(100vh-120px)] grid gap-6 md:gap-8 px-4 sm:px-6 lg:px-8',
      showSidebar && hasToc ? 'grid-cols-1 md:grid-cols-[240px_1fr] lg:grid-cols-[260px_1fr_200px]' : 
      showSidebar && !hasToc ? 'grid-cols-1 md:grid-cols-[240px_1fr]' : 
      !showSidebar && hasToc ? 'grid-cols-1 lg:grid-cols-[1fr_200px]' : 
      'grid-cols-1'
    ]}
  >
    {showSidebar && (
      <aside class="hidden md:block py-6 md:py-8 lg:py-10 border-r border-border/50 sticky top-[60px] h-[calc(100vh-60px)] overflow-y-auto pr-4 lg:pr-6 custom-scrollbar">
        <div class="mb-6">
          <a href="/notes" class="text-lg font-semibold text-foreground hover:text-primary transition-colors">笔记</a>
        </div>
        <WikiSidebar currentSlug={currentSlug} />
      </aside>
    )}

    <main class="py-6 md:py-8 lg:py-10 min-w-0 max-w-3xl w-full mx-auto">
      <article class="w-full text-foreground/90 leading-relaxed">
        <div class="w-full text-base">
          <slot />
        </div>
      </article>
    </main>

    {hasToc && (
      <aside class="hidden lg:block py-8 lg:py-10 sticky top-[60px] h-fit max-h-[calc(100vh-60px)] overflow-y-auto pl-4 custom-scrollbar">
        <TableOfContents headings={headings} />
      </aside>
    )}
  </div>
</BaseLayout>

<style>
  /* Optional: Custom thin scrollbar for sidebars */
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: var(--color-border);
    border-radius: 4px;
  }
  .custom-scrollbar:hover::-webkit-scrollbar-thumb {
    background: var(--color-muted-foreground);
  }
</style>
