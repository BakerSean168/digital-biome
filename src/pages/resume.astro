---
/**
 * ç®€å†é¡µé¢ - ä» Content Collection è¯»å–æ•°æ®
 * æ”¯æŒæ‰“å°ä¸º PDF
 */
import ResumeLayout from '../layouts/ResumeLayout.astro';
import { getEntry } from 'astro:content';

// å°è¯•ä» meta é›†åˆè¯»å–ç®€å†æ•°æ®
let resumeData;
try {
  const entry = await getEntry('meta', 'resume');
  resumeData = entry?.data;
} catch {
  resumeData = null;
}

// é»˜è®¤æ•°æ®ï¼ˆå½“æ²¡æœ‰ YAML æ–‡ä»¶æ—¶ä½¿ç”¨ï¼‰
const data = resumeData || {
  name: 'Your Name',
  title: 'Web Developer',
  bio: 'Experienced developer passionate about building great products.',
  contact: {
    email: 'your-email@example.com',
    github: 'github.com/username',
    location: 'City, Country',
  },
  experience: [],
  education: [],
  skills: {},
  projects: [],
};
---

<ResumeLayout title="Resume" name={data.name}>
  <header class="resume-header">
    <h1>{data.name}</h1>
    <p class="title">{data.title}</p>
    {data.bio && <p class="bio">{data.bio}</p>}
    
    <div class="contact-grid">
      {data.contact?.email && (
        <a href={`mailto:${data.contact.email}`} class="contact-item">
          <span class="icon">ğŸ“§</span>
          <span>{data.contact.email}</span>
        </a>
      )}
      {data.contact?.github && (
        <a href={`https://${data.contact.github}`} target="_blank" class="contact-item">
          <span class="icon">ğŸ’»</span>
          <span>{data.contact.github}</span>
        </a>
      )}
      {data.contact?.linkedin && (
        <a href={`https://${data.contact.linkedin}`} target="_blank" class="contact-item">
          <span class="icon">ğŸ’¼</span>
          <span>LinkedIn</span>
        </a>
      )}
      {data.contact?.location && (
        <span class="contact-item">
          <span class="icon">ğŸ“</span>
          <span>{data.contact.location}</span>
        </span>
      )}
      {data.contact?.website && (
        <a href={data.contact.website} target="_blank" class="contact-item">
          <span class="icon">ğŸŒ</span>
          <span>Website</span>
        </a>
      )}
    </div>
  </header>

  <!-- å·¥ä½œç»å† -->
  {data.experience.length > 0 && (
    <section class="resume-section">
      <h2>ğŸ’¼ å·¥ä½œç»å†</h2>
      <div class="timeline">
        {data.experience.map((exp: any) => (
          <article class="timeline-item">
            <div class="timeline-header">
              <div>
                <h3>{exp.role}</h3>
                <p class="company">{exp.company}</p>
              </div>
              <span class="period">{exp.period}</span>
            </div>
            {exp.description && <p class="desc">{exp.description}</p>}
            {exp.highlights.length > 0 && (
              <ul class="highlights">
                {exp.highlights.map((h: string) => <li>{h}</li>)}
              </ul>
            )}
          </article>
        ))}
      </div>
    </section>
  )}

  <!-- æ•™è‚²èƒŒæ™¯ -->
  {data.education.length > 0 && (
    <section class="resume-section">
      <h2>ğŸ“ æ•™è‚²èƒŒæ™¯</h2>
      <div class="timeline">
        {data.education.map((edu: any) => (
          <article class="timeline-item">
            <div class="timeline-header">
              <div>
                <h3>{edu.degree}</h3>
                <p class="company">{edu.school}</p>
              </div>
              <span class="period">{edu.period}</span>
            </div>
            {edu.major && <p class="desc">ä¸“ä¸šï¼š{edu.major}</p>}
          </article>
        ))}
      </div>
    </section>
  )}

  <!-- æŠ€èƒ½ -->
  {Object.keys(data.skills).length > 0 && (
    <section class="resume-section">
      <h2>ğŸ› ï¸ æŠ€èƒ½</h2>
      <div class="skills-grid">
        {Object.entries(data.skills).map(([category, items]) => (
          <div class="skill-category">
            <h4>{category}</h4>
            <div class="skill-tags">
              {(items as string[]).map((skill: string) => (
                <span class="skill-tag">{skill}</span>
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>
  )}

  <!-- é¡¹ç›® -->
  {data.projects.length > 0 && (
    <section class="resume-section">
      <h2>ğŸš€ é¡¹ç›®</h2>
      <div class="projects-grid">
        {data.projects.map((proj: any) => (
          <article class="project-card">
            <h3>
              {proj.url ? (
                <a href={proj.url} target="_blank">{proj.name}</a>
              ) : proj.name}
            </h3>
            {proj.tech && <p class="tech">{proj.tech}</p>}
            <p class="desc">{proj.description}</p>
          </article>
        ))}
      </div>
    </section>
  )}

  <!-- ç©ºçŠ¶æ€æç¤º -->
  {!resumeData && (
    <div class="empty-hint">
      <p>ğŸ’¡ æç¤ºï¼šåˆ›å»º <code>src/content/meta/resume.yaml</code> æ¥è‡ªå®šä¹‰ç®€å†å†…å®¹</p>
    </div>
  )}
</ResumeLayout>

<style>
  .resume-header {
    text-align: center;
    margin-bottom: 2.5rem;
    padding-bottom: 2rem;
    border-bottom: 2px solid #0066cc;
  }

  .resume-header h1 {
    font-size: 2.5rem;
    margin: 0;
  }

  .title {
    font-size: 1.25rem;
    color: #0066cc;
    margin: 0.5rem 0;
    font-weight: 500;
  }

  .bio {
    color: #666;
    max-width: 600px;
    margin: 1rem auto;
    line-height: 1.6;
  }

  .contact-grid {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
    margin-top: 1.5rem;
  }

  .contact-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    color: #555;
    text-decoration: none;
    font-size: 0.9rem;
  }

  .contact-item:hover {
    color: #0066cc;
  }

  .resume-section {
    margin-bottom: 2.5rem;
  }

  .resume-section h2 {
    font-size: 1.25rem;
    color: #0066cc;
    margin: 0 0 1.25rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #0066cc;
  }

  .timeline {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .timeline-item {
    padding-left: 1.25rem;
    border-left: 3px solid #e5e5e5;
    position: relative;
  }

  .timeline-item::before {
    content: '';
    position: absolute;
    left: -7px;
    top: 6px;
    width: 10px;
    height: 10px;
    background: #0066cc;
    border-radius: 50%;
  }

  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .timeline-item h3 {
    margin: 0;
    font-size: 1.1rem;
  }

  .company {
    color: #0066cc;
    font-weight: 500;
    margin: 0.25rem 0 0;
  }

  .period {
    font-size: 0.85rem;
    color: #888;
    white-space: nowrap;
  }

  .desc {
    margin: 0.75rem 0 0;
    color: #555;
    font-size: 0.95rem;
  }

  .highlights {
    margin: 0.75rem 0 0;
    padding-left: 1.25rem;
  }

  .highlights li {
    margin: 0.4rem 0;
    color: #555;
  }

  .skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
  }

  .skill-category h4 {
    margin: 0 0 0.75rem;
    font-size: 0.9rem;
    color: #333;
  }

  .skill-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .skill-tag {
    font-size: 0.8rem;
    padding: 0.3rem 0.6rem;
    background: #f0f7ff;
    color: #0066cc;
    border-radius: 4px;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .project-card {
    padding: 1rem;
    background: #fafafa;
    border-radius: 8px;
    border: 1px solid #e5e5e5;
  }

  .project-card h3 {
    margin: 0;
    font-size: 1rem;
  }

  .project-card a {
    color: #0066cc;
    text-decoration: none;
  }

  .project-card a:hover {
    text-decoration: underline;
  }

  .tech {
    font-size: 0.8rem;
    color: #888;
    margin: 0.25rem 0;
  }

  .project-card .desc {
    font-size: 0.9rem;
    margin: 0.5rem 0 0;
  }

  .empty-hint {
    text-align: center;
    padding: 2rem;
    background: #f0f7ff;
    border-radius: 8px;
    margin-top: 2rem;
  }

  .empty-hint code {
    background: #fff;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
  }

  :global(html.dark) .bio,
  :global(html.dark) .contact-item,
  :global(html.dark) .desc,
  :global(html.dark) .highlights li {
    color: #bbb;
  }

  :global(html.dark) .skill-tag {
    background: rgba(100, 150, 255, 0.15);
  }

  :global(html.dark) .project-card {
    background: #252545;
    border-color: #3d3d5c;
  }

  :global(html.dark) .empty-hint {
    background: rgba(100, 150, 255, 0.1);
  }

  @media print {
    .resume-section {
      break-inside: avoid;
    }
    .empty-hint {
      display: none;
    }
  }
</style>
